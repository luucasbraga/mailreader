databaseChangeLog:

  # Inclusão de nome do emissor na tabela de regex
  - changeSet:
      id: 20250224145000-1
      author: marco.gomes
      changes:
        - addColumn:
            tableName: tb_regex
            columns:
              - column:
                  name: ISSUER_NAME
                  type: VARCHAR(255)

  # Alteração de regex para NFE
  - changeSet:
      id: 20250224145000-2
      author: marco.gomes
      changes:
        - update:
            tableName: tb_regex
            columns:
              - column:
                  name: ISSUER_CNPJ
                  value: "(?i)(?:CNPJ(?:\\/CPF)?[:\\s-]*)\\s*((?:\\d{2}\\.?\\d{3}\\.?\\d{3}\\/?\\d{4}-?\\d{2})|\\d{11,14})"
              - column:
                  name: DUE_DATE
                  value: "(?i)(?:(?:DATA(?:\\s*(?:DO|DA))?\\s*(?:EMISS[AÃ]O|ENTRADA\\/SA[IÍ]DA)|Vencimento))[:\\s-]*\\s*(\\d{2}[\\/-]\\d{2}[\\/-]\\d{4})"
              - column:
                  name: ISSUE_DATE
                  value: "(?i)(?:(?:DATA(?:\\s*(?:DO|DA))?\\s*(?:EMISS[AÃ]O|Entrada\\/Sa[IÍ]da)|Emiss[AÃ]o))[:\\s-]*\\s*(\\d{2}[\\/-]\\d{2}[\\/-]\\d{4})"
              - column:
                  name: SERIE
                  value: "(?i)S[ÉE]RIE[:\\s-]*\\s*([0-9A-Za-z]+)"
              - column:
                  name: NUMBER
                  value: "(?i)(?:(?:N[uú]mero(?:\\s*(?:da\\s*(?:NFS-e|Documento))?)?|Nota\\s*N[uú]mero|Nº\\.?))[\\s:-]*([0-9]{3,}(?:[\\.\\-][0-9]{3,})+)"
              - column:
                  name: ISSUER_NAME
                  value: "(?i)Identifica(?:ç|c)ão\\s+do\\s+emitente\\s*\\r?\\n\\s*([A-Z0-9À-Ú\\s\\.\\&]+)(?:\\r?\\n\\s*(?!RUA|CEP|TELEFONE|ENDERECO|INSCRI[CÇ]ÃO)[A-Z0-9À-Ú\\s\\.\\&]+)?\n"
              - column:
                  name: TOTAL_VALUE
                  value: "(?i)(?:VALOR\\s*TOTAL\\s*(?:DA\\s*(?:NOTA|PRODUTOS))?)[\\s\\.:=-]*[\\r\\n\\s]*R?\\$?\\s*([0-9]{1,3}(?:(?:[.,][0-9]{3})+)?(?:[.,][0-9]{2}))"
            where: "TYPE = 'NFE'"

  # Alteração de regex para NFSE
  - changeSet:
      id: 20250224145000-3
      author: marco.gomes
      changes:
        - update:
            tableName: tb_regex
            columns:
              - column:
                  name: ISSUER_CNPJ
                  value: "(?i)(?:CPF/CNPJ|CNPJ):\\s*(\\d{2}\\.\\d{3}\\.\\d{3}/\\d{4}-\\d{2})"
              - column:
                  name: DUE_DATE
                  value: "(?i)Data/Hora\\s+da\\s+emiss[ãa]o\\s*\\n\\s*(\\d{2}/\\d{2}/\\d{4})"
              - column:
                  name: ISSUE_DATE
                  value: "(?i)(?:(?:DATA(?:\\s*(?:DO|DA))?\\s*(?:EMISS[AÃ]O|Entrada\\/Sa[IÍ]da)|Emiss[AÃ]o))[:\\s-]*\\s*(\\d{2}[\\/-]\\d{2}[\\/-]\\d{4})"
              - column:
                  name: SERIE
                  value: "(?i)Inscri[cç][ãa]o\\s+Municipal\\s*[:\\-]?\\s*([\\d\\.\\-/]+)"
              - column:
                  name: NUMBER
                  value: "(?i)Nº:\\s*(\\d{4}/\\d+)"
              - column:
                  name: ISSUER_NAME
                  value: "(?mi)^(.*(?:LTDA|S[\\.\\s]?A[\\.\\s]?|EIRELI).*)$"
              - column:
                  name: TOTAL_VALUE
                  value: "(?i)VALOR\\s+TOTAL\\s+DO\\s+RPS\\s*=\\s*(?:R\\$)?\\s*([0-9]{1,3}(?:\\.[0-9]{3})*,[0-9]{2})"
            where: "TYPE = 'NFSE'"